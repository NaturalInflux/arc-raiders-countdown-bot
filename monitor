#!/bin/bash

# Arc Raiders Countdown Bot Monitor
# Simple command to view basic monitoring data

DATA_FILE="monitor-data.json"

echo "🔍 Arc Raiders Countdown Bot Monitor"
echo "=================================="
echo ""

# Check if monitoring data exists
if [ ! -f "$DATA_FILE" ]; then
    echo "❌ No monitoring data found"
    echo "Make sure the bot is running"
    exit 1
fi

# Check if bot is running
if ! pm2 list | grep -q "arc-raiders-countdown-bot"; then
    echo "❌ Bot is not running"
    echo "Start it with: pm2 start arc-raiders-countdown-bot"
    exit 1
fi

echo "✅ Bot is running"
echo ""

# Read and display monitoring data
if command -v jq >/dev/null 2>&1; then
    # Use jq if available
    servers=$(jq -r '.servers // "Unknown"' "$DATA_FILE")
    last_updated=$(jq -r '.last_updated // "Unknown"' "$DATA_FILE")
else
    # Fallback without jq
    servers=$(grep -o '"servers": [0-9]*' "$DATA_FILE" | grep -o '[0-9]*' || echo "Unknown")
    last_updated=$(grep -o '"last_updated": "[^"]*"' "$DATA_FILE" | cut -d'"' -f4 || echo "Unknown")
fi

# Display server statistics
echo "📊 Server Statistics:"
echo "  Current servers: $servers"
echo "  Last updated: $last_updated"
echo ""

# Show PM2 status
echo "📝 PM2 Status:"
pm2 status arc-raiders-countdown-bot
